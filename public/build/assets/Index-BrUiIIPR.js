import{r as p,o as O,G as R,A as $,L as W,c as i,a as n,b as v,u as y,g as E,w as _,d as t,t as a,S as j,i as b,F as k,e as A,n as P}from"./app-BvKMgCPM.js";import{_ as G}from"./AppLayout-CPl3rLGK.js";import{C as T}from"./auto-C0VlNTRY.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"flex justify-between items-center"},J=["disabled"],K={key:0},Q={key:1},X={class:"py-12"},Y={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},tt={key:0,class:"flex justify-center items-center py-20"},et={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},st={key:2},ot={class:"mb-4 text-right text-sm text-gray-500"},at={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"},it={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},nt={class:"p-6 bg-white"},rt={class:"flex items-center"},lt={class:"ml-4"},dt={class:"mt-1 text-3xl font-semibold text-gray-900"},ct={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ut={class:"p-6 bg-white"},pt={class:"flex items-center"},ht={class:"ml-4"},gt={class:"mt-1 text-3xl font-semibold text-gray-900"},mt={class:"col-span-1 md:col-span-2"},xt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg h-full"},vt={class:"p-6 bg-white h-full"},_t={class:"flex flex-wrap gap-4"},ft={class:"flex items-center bg-green-50 rounded-lg px-4 py-2"},wt={class:"text-lg font-semibold text-gray-900"},yt={class:"flex items-center bg-yellow-50 rounded-lg px-4 py-2"},bt={class:"text-lg font-semibold text-gray-900"},kt={class:"flex items-center bg-red-50 rounded-lg px-4 py-2"},Ct={class:"text-lg font-semibold text-gray-900"},Mt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},Bt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Dt={class:"p-6 bg-white"},jt={style:{height:"300px","max-height":"300px"}},At={class:"mt-4 text-center"},Pt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Tt={class:"p-6 bg-white"},It={style:{height:"300px","max-height":"300px"}},zt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg mb-6"},Vt={class:"p-6 bg-white"},Ht={key:0,class:"text-center py-8 text-gray-500"},St={key:1,class:"overflow-x-auto"},Lt={class:"min-w-full divide-y divide-gray-200"},Ft={class:"bg-white divide-y divide-gray-200"},Ut={class:"px-6 py-4 whitespace-nowrap"},Nt={class:"flex items-center"},Ot={class:"flex-shrink-0 h-10 w-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold"},Rt={class:"ml-4"},$t={class:"text-sm font-medium text-gray-900"},Wt={class:"text-sm text-gray-500"},Et={class:"px-6 py-4 whitespace-nowrap"},Gt={class:"text-sm text-gray-900"},Zt={class:"text-xs text-gray-500"},qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Jt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Kt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Qt={class:"p-6 bg-white"},Xt={key:0,class:"text-center py-8 text-gray-500"},Yt={key:1,class:"space-y-4"},te={class:"flex items-start"},ee=["viewBox"],se=["d"],oe={class:"flex-1"},ae={class:"text-sm text-gray-700"},ie={class:"mt-1 flex items-center text-xs text-gray-500"},ne={__name:"Index",setup(re){const d=p(!1),h=p(null),f=p(null),r=p({totalChannels:0,totalPosts:0,sentPosts:0,scheduledPosts:0,failedPosts:0,weekdayDistribution:{},contentTypeDistribution:{},topChannels:[],recentActivity:[]}),g=p(null),m=p(null);let c=null,u=null;O(async()=>{M(!1)}),R(()=>{C()});const C=()=>{c&&(c.destroy(),c=null),u&&(u.destroy(),u=null)},I=()=>{C(),M(!0)},M=async(o=!1)=>{d.value=!0,h.value=null;try{const e=o?route("statistics",{refresh:!0}):route("statistics"),s=await $.get(e);f.value=s.data.last_updated_at||new Date().toISOString(),s.data&&(r.value={totalChannels:s.data.total_channels||0,totalPosts:s.data.total_posts||0,sentPosts:s.data.sent_posts||0,scheduledPosts:s.data.scheduled_posts||0,failedPosts:s.data.failed_posts||0,weekdayDistribution:s.data.weekday_distribution||{1:0,2:0,3:0,4:0,5:0,6:0,7:0},contentTypeDistribution:s.data.content_type_distribution||{text_only:70,with_image:20,with_video:5,with_file:5},topChannels:(s.data.top_channels||[]).map(l=>({id:l.id,name:l.name||"Неизвестно",username:l.username||l.telegram_id||"unknown",post_count:l.post_count||0,last_activity:l.last_activity||new Date().toISOString()})),recentActivity:s.data.recent_activity||[]}),d.value=!1,W(()=>{g.value&&V(),m.value&&H()})}catch(e){console.error("Failed to load statistics:",e),h.value="Не удалось загрузить статистику. Пожалуйста, попробуйте позже.",d.value=!1}},B=o=>{if(!o)return"Нет данных";const e=new Date(o);return new Intl.DateTimeFormat("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)},z=o=>{if(!o)return"Неизвестно";const e=new Date(o);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)},V=()=>{if(!g.value)return;const o=g.value.getContext("2d");c&&c.destroy();const e=["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],s=e.map((l,x)=>{const w=x+1;return r.value.weekdayDistribution[w]||0});c=new T(o,{type:"bar",data:{labels:e,datasets:[{label:"Количество постов",data:s,backgroundColor:"rgba(79, 70, 229, 0.5)",borderColor:"rgba(79, 70, 229, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})},H=()=>{if(!m.value)return;const o=m.value.getContext("2d"),e=r.value.contentTypeDistribution;u&&u.destroy(),u=new T(o,{type:"pie",data:{labels:Object.keys(e).map(s=>{switch(s){case"text_only":return"Только текст";case"with_image":return"С изображениями";case"with_video":return"С видео";case"with_file":return"С файлами";default:return s}}),datasets:[{data:Object.values(e),backgroundColor:["rgba(54, 162, 235, 0.7)","rgba(255, 99, 132, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:s=>{const l=s.label||"",x=s.raw,w=s.dataset.data.reduce((U,N)=>U+N,0),F=Math.round(x/w*100);return`${l}: ${x} (${F}%)`}}}}}})},S=o=>{switch(o){case"post_sent":return"border-green-500";case"post_scheduled":return"border-yellow-500";case"post_failed":return"border-red-500";case"channel_created":return"border-blue-500";case"channel_updated":return"border-purple-500";default:return"border-gray-500"}},L=o=>{switch(o){case"post_sent":return"bg-green-500";case"post_scheduled":return"bg-yellow-500";case"post_failed":return"bg-red-500";case"channel_created":return"bg-blue-500";case"channel_updated":return"bg-purple-500";default:return"bg-gray-500"}},D=o=>{switch(o){case"post_sent":return{viewBox:"0 0 24 24",path:"M5 13l4 4L19 7"};case"post_scheduled":return{viewBox:"0 0 24 24",path:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"};case"post_failed":return{viewBox:"0 0 24 24",path:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"};case"channel_created":return{viewBox:"0 0 24 24",path:"M12 4v16m8-8H4"};case"channel_updated":return{viewBox:"0 0 24 24",path:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"};default:return{viewBox:"0 0 24 24",path:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}}};return(o,e)=>(n(),i(k,null,[v(y(E),{title:"Статистика"}),v(G,{title:"Статистика"},{header:_(()=>[t("div",q,[e[2]||(e[2]=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Статистика ",-1)),t("button",{onClick:I,class:"px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 flex items-center",disabled:d.value},[d.value?(n(),i("span",K,e[0]||(e[0]=[t("svg",{class:"animate-spin h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(n(),i("span",Q,e[1]||(e[1]=[t("svg",{class:"h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))),b(" "+a(d.value?"Обновление...":"Обновить данные"),1)],8,J)])]),default:_(()=>[t("div",X,[t("div",Y,[d.value?(n(),i("div",tt,e[3]||(e[3]=[t("div",{class:"loader"},null,-1),t("p",{class:"ml-4 text-gray-600"},"Загрузка статистики...",-1)]))):h.value?(n(),i("div",et,[t("p",null,a(h.value),1)])):(n(),i("div",st,[t("div",ot," Последнее обновление: "+a(f.value?z(f.value):"Неизвестно"),1),t("div",at,[t("div",it,[t("div",nt,[t("div",rt,[e[5]||(e[5]=t("div",{class:"p-3 rounded-full bg-blue-100 text-blue-500"},[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})])],-1)),t("div",lt,[e[4]||(e[4]=t("p",{class:"text-sm font-medium text-gray-500 truncate"},"Каналов",-1)),t("p",dt,a(r.value.totalChannels),1)])])])]),t("div",ct,[t("div",ut,[t("div",pt,[e[7]||(e[7]=t("div",{class:"p-3 rounded-full bg-indigo-100 text-indigo-500"},[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t("div",ht,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-gray-500 truncate"},"Постов",-1)),t("p",gt,a(r.value.totalPosts),1)])])])]),t("div",mt,[t("div",xt,[t("div",vt,[e[14]||(e[14]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Статус постов",-1)),t("div",_t,[t("div",ft,[e[9]||(e[9]=t("div",{class:"rounded-full h-8 w-8 flex items-center justify-center bg-green-500 text-white mr-2"},[t("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),t("div",null,[e[8]||(e[8]=t("p",{class:"text-sm text-gray-600"},"Отправлено",-1)),t("p",wt,a(r.value.sentPosts),1)])]),t("div",yt,[e[11]||(e[11]=t("div",{class:"rounded-full h-8 w-8 flex items-center justify-center bg-yellow-500 text-white mr-2"},[t("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",null,[e[10]||(e[10]=t("p",{class:"text-sm text-gray-600"},"Запланировано",-1)),t("p",bt,a(r.value.scheduledPosts),1)])]),t("div",kt,[e[13]||(e[13]=t("div",{class:"rounded-full h-8 w-8 flex items-center justify-center bg-red-500 text-white mr-2"},[t("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",null,[e[12]||(e[12]=t("p",{class:"text-sm text-gray-600"},"Ошибки",-1)),t("p",Ct,a(r.value.failedPosts),1)])])])])])])]),t("div",Mt,[t("div",Bt,[t("div",Dt,[e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Активность по дням недели",-1)),t("div",jt,[t("canvas",{ref_key:"weekdayChart",ref:g},null,512)]),t("div",At,[v(y(j),{href:o.route("statistics.posts"),class:"text-sm text-indigo-600 hover:text-indigo-900"},{default:_(()=>e[15]||(e[15]=[b(" Подробный анализ постов → ")])),_:1},8,["href"])])])]),t("div",Pt,[t("div",Tt,[e[17]||(e[17]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Типы контента",-1)),t("div",It,[t("canvas",{ref_key:"contentTypeChart",ref:m},null,512)])])])]),t("div",zt,[t("div",Vt,[e[20]||(e[20]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Топ каналов по активности",-1)),r.value.topChannels.length===0?(n(),i("div",Ht," У вас еще нет активных каналов ")):(n(),i("div",St,[t("table",Lt,[e[19]||(e[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Канал"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Посты"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Последняя активность"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"})])],-1)),t("tbody",Ft,[(n(!0),i(k,null,A(r.value.topChannels,s=>(n(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",Ut,[t("div",Nt,[t("div",Ot,a(s.name.charAt(0).toUpperCase()),1),t("div",Rt,[t("div",$t,a(s.name),1),t("div",Wt,"@"+a(s.username),1)])])]),t("td",Et,[t("div",Gt,a(s.post_count)+" постов",1),t("div",Zt,a(Math.round(s.post_count/r.value.totalPosts*100)||0)+"% от общего числа",1)]),t("td",qt,a(B(s.last_activity)),1),t("td",Jt,[v(y(j),{href:o.route("statistics.channel.detail",{channel:s.id}),class:"text-indigo-600 hover:text-indigo-900"},{default:_(()=>e[18]||(e[18]=[b(" Детали ")])),_:2},1032,["href"])])]))),128))])])]))])]),t("div",Kt,[t("div",Qt,[e[22]||(e[22]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Недавняя активность",-1)),r.value.recentActivity.length===0?(n(),i("div",Xt," Нет недавней активности ")):(n(),i("div",Yt,[(n(!0),i(k,null,A(r.value.recentActivity,s=>(n(),i("div",{key:s.id,class:P(["border-l-4 pl-4",S(s.type)])},[t("div",te,[t("div",{class:P([L(s.type),"rounded-full p-2 mr-3 mt-1"])},[(n(),i("svg",{class:"h-4 w-4 text-white",viewBox:D(s.type).viewBox,fill:"none",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:D(s.type).path},null,8,se)],8,ee))],2),t("div",oe,[t("p",ae,a(s.message),1),t("div",ie,[t("span",null,a(B(s.created_at)),1),e[21]||(e[21]=t("span",{class:"mx-2"},"•",-1)),t("span",null,a(s.channel_name),1)])])])],2))),128))]))])])]))])])]),_:1})],64))}},pe=Z(ne,[["__scopeId","data-v-e666c2e0"]]);export{pe as default};
