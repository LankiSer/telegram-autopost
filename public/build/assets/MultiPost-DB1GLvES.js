import{r as m,k as P,o as N,A as F,p as T,c as o,a as i,b as k,w as M,d as t,j as a,F as y,e as C,t as d,h as g,u as G,S as I,i as j,q as p,s as R,v as L,n as O,D as B}from"./app-BvKMgCPM.js";import{_ as q}from"./AppLayout-CPl3rLGK.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"py-12"},Y={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},K={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Q={class:"p-6 bg-white border-b border-gray-200"},X={key:0,class:"flex flex-col items-center justify-center py-10"},Z={key:1,class:"mb-6"},ee={class:"flex"},te={class:"ml-3"},se={class:"text-red-700"},le={key:2,class:"bg-green-100 border-l-4 border-green-500 p-4 mb-6"},oe={class:"flex"},ie={class:"ml-3"},ne={class:"text-green-700"},re={class:"mb-6"},ae={key:0,class:"text-center py-6"},de={key:1,class:"bg-yellow-50 p-4 rounded-lg"},ue={key:2},ce={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},me=["value"],ve={class:"ml-3 flex flex-col"},pe={class:"block text-sm font-medium text-gray-900"},ge={class:"block text-sm text-gray-500"},fe={key:1,class:"mt-2 text-sm text-red-600"},he={class:"mb-6"},xe={key:0,class:"mt-2 text-sm text-red-600"},be={class:"mb-6"},_e={class:"mt-2 flex justify-center text-sm text-gray-600"},ye={for:"file-upload",class:"relative cursor-pointer rounded-md font-medium text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-500 focus-within:ring-offset-2 hover:text-indigo-500"},we={key:0,class:"mt-2 text-sm text-red-600"},ke={key:1,class:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"},Me=["src"],Ce={key:1,class:"h-24 w-full flex items-center justify-center bg-gray-100"},Le=["onClick"],Ve={class:"text-xs truncate p-1 text-center"},Fe={class:"mb-6"},je={class:"space-y-4"},Be={class:"flex items-center"},De={class:"flex items-center"},ze={key:0,class:"ml-7 grid grid-cols-1 md:grid-cols-2 gap-4"},Se=["min"],$e={key:0,class:"mt-2 text-sm text-red-600"},Ee={key:0,class:"mt-2 text-sm text-red-600"},Ue={class:"flex justify-end"},Ae=["disabled"],He={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Pe={__name:"MultiPost",setup(Ne){const f=m(!1),w=m(!0),h=m(!1),x=m(!1),b=m([]),u=m([]),r=m({}),_=m(""),l=m({channel_ids:[],content:"",files:[],publish_time:"now",schedule_date:"",schedule_time:""}),D=P(()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`});N(async()=>{try{const s=await F.get(route("channels.list"));b.value=s.data,w.value=!1}catch(s){console.error("Error loading channels:",s),u.value.push("Не удалось загрузить список каналов. Пожалуйста, обновите страницу."),w.value=!1}});const z=s=>{V(Array.from(s.target.files)),s.target.value=null},S=s=>{x.value=!1,V(Array.from(s.dataTransfer.files))},V=s=>{for(const e of s){if(e.size>10*1024*1024){u.value.push(`Файл ${e.name} превышает допустимый размер 10MB`);continue}if(!["image/jpeg","image/png","image/gif","video/mp4"].includes(e.type)){u.value.push(`Файл ${e.name} имеет неподдерживаемый формат`);continue}l.value.files.push(e)}},$=s=>{l.value.files.splice(s,1)},E=s=>s.type.startsWith("image/"),U=s=>URL.createObjectURL(s),A=()=>{r.value={};let s=!0;return l.value.channel_ids.length===0&&(r.value.channel_ids="Выберите хотя бы один канал для публикации",s=!1),l.value.content.trim()||(r.value.content="Введите содержание поста",s=!1),l.value.publish_time==="scheduled"&&(l.value.schedule_date||(r.value.schedule_date="Выберите дату публикации",s=!1),l.value.schedule_time||(r.value.schedule_time="Выберите время публикации",s=!1)),s},H=async()=>{if(A()){h.value=!0,f.value=!0,u.value=[],_.value="";try{const s=new FormData;l.value.channel_ids.forEach(c=>{s.append("channel_ids[]",c)}),s.append("content",l.value.content),l.value.files.forEach(c=>{s.append("files[]",c)}),s.append("publish_time",l.value.publish_time),l.value.publish_time==="scheduled"&&(s.append("schedule_date",l.value.schedule_date),s.append("schedule_time",l.value.schedule_time));const e=await F.post(route("features.multipost.store"),s,{headers:{"Content-Type":"multipart/form-data"}});_.value=l.value.publish_time==="now"?"Посты успешно отправлены во все выбранные каналы":"Посты успешно запланированы для публикации",l.value={channel_ids:[],content:"",files:[],publish_time:"now",schedule_date:"",schedule_time:""}}catch(s){if(console.error("Error submitting form:",s),s.response&&s.response.data&&s.response.data.errors){const e=s.response.data.errors;Object.keys(e).forEach(c=>{Array.isArray(e[c])?u.value.push(...e[c]):u.value.push(e[c])})}else u.value.push("Произошла ошибка при отправке постов. Пожалуйста, попробуйте еще раз.")}finally{h.value=!1,f.value=!1}}};return(s,e)=>{const c=T("Head");return i(),o(y,null,[k(c,{title:"Мульти-постинг"}),k(q,{title:"Мульти-постинг"},{header:M(()=>e[8]||(e[8]=[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Отправка поста в несколько каналов ",-1)])),default:M(()=>[t("div",W,[t("div",Y,[t("div",K,[t("div",Q,[f.value?(i(),o("div",X,e[9]||(e[9]=[t("div",{class:"loader mb-4"},null,-1),t("p",{class:"text-gray-600"},"Отправка постов...",-1)]))):a("",!0),u.value.length>0?(i(),o("div",Z,[(i(!0),o(y,null,C(u.value,(n,v)=>(i(),o("div",{key:v,class:"bg-red-100 border-l-4 border-red-500 p-4 mb-3"},[t("div",ee,[e[10]||(e[10]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),t("div",te,[t("p",se,d(n),1)])])]))),128))])):a("",!0),_.value?(i(),o("div",le,[t("div",oe,[e[11]||(e[11]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-green-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),t("div",ie,[t("p",ne,d(_.value),1)])])])):a("",!0),f.value?a("",!0):(i(),o("form",{key:3,onSubmit:g(H,["prevent"])},[t("div",re,[e[15]||(e[15]=t("h3",{class:"text-lg font-medium text-gray-900 mb-3"},"Выберите каналы для отправки",-1)),w.value?(i(),o("div",ae,e[12]||(e[12]=[t("div",{class:"loader mx-auto mb-3"},null,-1),t("p",{class:"text-gray-500"},"Загружаем ваши каналы...",-1)]))):b.value.length===0?(i(),o("div",de,[e[14]||(e[14]=t("p",{class:"text-yellow-700"},"У вас пока нет каналов. Создайте канал, чтобы начать отправку постов.",-1)),k(G(I),{href:s.route("channels.create"),class:"mt-3 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},{default:M(()=>e[13]||(e[13]=[j(" Создать канал ")])),_:1},8,["href"])])):(i(),o("div",ue,[b.value.length>0?(i(),o("div",ce,[(i(!0),o(y,null,C(b.value,n=>(i(),o("label",{key:n.id,class:"relative inline-flex p-4 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-50 focus-within:ring-2 focus-within:ring-indigo-500"},[p(t("input",{type:"checkbox",value:n.id,"onUpdate:modelValue":e[0]||(e[0]=v=>l.value.channel_ids=v),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,8,me),[[R,l.value.channel_ids]]),t("div",ve,[t("span",pe,d(n.name),1),t("span",ge,"@"+d(n.username),1)])]))),128))])):a("",!0),r.value.channel_ids?(i(),o("p",fe,d(r.value.channel_ids),1)):a("",!0)]))]),t("div",he,[e[16]||(e[16]=t("label",{for:"content",class:"block text-sm font-medium text-gray-700"},"Содержание поста",-1)),p(t("textarea",{id:"content","onUpdate:modelValue":e[1]||(e[1]=n=>l.value.content=n),rows:"6",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",placeholder:"Введите содержание поста..."},null,512),[[L,l.value.content]]),r.value.content?(i(),o("p",xe,d(r.value.content),1)):a("",!0),e[17]||(e[17]=t("p",{class:"mt-2 text-sm text-gray-500"}," Поддерживается форматирование MarkdownV2 Telegram: *курсив*, **жирный**, __подчеркнутый__, `код`, [ссылка](http://example.com) ",-1))]),t("div",be,[e[24]||(e[24]=t("span",{class:"block text-sm font-medium text-gray-700 mb-2"},"Медиафайлы (опционально)",-1)),t("div",{onDragover:e[2]||(e[2]=g(n=>x.value=!0,["prevent"])),onDragleave:e[3]||(e[3]=g(n=>x.value=!1,["prevent"])),onDrop:g(S,["prevent"]),class:O(["p-6 border-2 border-dashed rounded-lg text-center",x.value?"border-indigo-500 bg-indigo-50":"border-gray-300"])},[e[20]||(e[20]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48"},[t("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),t("div",_e,[t("label",ye,[e[18]||(e[18]=t("span",null,"Загрузить файл",-1)),t("input",{id:"file-upload",type:"file",class:"sr-only",multiple:"",onChange:z},null,32)]),e[19]||(e[19]=t("p",{class:"pl-1"},"или перетащите файлы сюда",-1))]),e[21]||(e[21]=t("p",{class:"text-xs text-gray-500 mt-1"},"PNG, JPG, GIF до 10MB",-1))],34),r.value.files?(i(),o("p",we,d(r.value.files),1)):a("",!0),l.value.files.length>0?(i(),o("div",ke,[(i(!0),o(y,null,C(l.value.files,(n,v)=>(i(),o("div",{key:v,class:"relative group border rounded-lg overflow-hidden"},[E(n)?(i(),o("img",{key:0,src:U(n),alt:"Preview",class:"h-24 w-full object-cover"},null,8,Me)):(i(),o("div",Ce,e[22]||(e[22]=[t("svg",{class:"h-8 w-8 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)]))),t("button",{onClick:g(Te=>$(v),["prevent"]),type:"button",class:"absolute top-1 right-1 bg-red-100 text-red-600 rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity"},e[23]||(e[23]=[t("svg",{class:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),8,Le),t("p",Ve,d(n.name),1)]))),128))])):a("",!0)]),t("div",Fe,[e[29]||(e[29]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Настройка отправки",-1)),t("div",je,[t("div",Be,[p(t("input",{id:"publish-now",name:"publish_time",type:"radio",value:"now","onUpdate:modelValue":e[4]||(e[4]=n=>l.value.publish_time=n),class:"h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[B,l.value.publish_time]]),e[25]||(e[25]=t("label",{for:"publish-now",class:"ml-3 block text-sm font-medium text-gray-700"}," Опубликовать сейчас ",-1))]),t("div",De,[p(t("input",{id:"publish-scheduled",name:"publish_time",type:"radio",value:"scheduled","onUpdate:modelValue":e[5]||(e[5]=n=>l.value.publish_time=n),class:"h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[B,l.value.publish_time]]),e[26]||(e[26]=t("label",{for:"publish-scheduled",class:"ml-3 block text-sm font-medium text-gray-700"}," Запланировать публикацию ",-1))]),l.value.publish_time==="scheduled"?(i(),o("div",ze,[t("div",null,[e[27]||(e[27]=t("label",{for:"schedule_date",class:"block text-sm font-medium text-gray-700"},"Дата",-1)),p(t("input",{type:"date",id:"schedule_date","onUpdate:modelValue":e[6]||(e[6]=n=>l.value.schedule_date=n),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",min:D.value},null,8,Se),[[L,l.value.schedule_date]]),r.value.schedule_date?(i(),o("p",$e,d(r.value.schedule_date),1)):a("",!0)]),t("div",null,[e[28]||(e[28]=t("label",{for:"schedule_time",class:"block text-sm font-medium text-gray-700"},"Время",-1)),p(t("input",{type:"time",id:"schedule_time","onUpdate:modelValue":e[7]||(e[7]=n=>l.value.schedule_time=n),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"},null,512),[[L,l.value.schedule_time]]),r.value.schedule_time?(i(),o("p",Ee,d(r.value.schedule_time),1)):a("",!0)])])):a("",!0)])]),t("div",Ue,[t("button",{type:"submit",class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:h.value},[h.value?(i(),o("svg",He,e[30]||(e[30]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):a("",!0),j(" "+d(l.value.publish_time==="now"?"Опубликовать сейчас":"Запланировать публикацию"),1)],8,Ae)])],32))])])])])]),_:1})],64)}}},Oe=J(Pe,[["__scopeId","data-v-380bd26f"]]);export{Oe as default};
