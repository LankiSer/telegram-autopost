import{r as c,o as W,G as Z,A as q,L as E,c as r,a as l,b as D,u as $,g as G,w as j,d as t,S as J,i as M,t as i,F as I,e as K,n as P}from"./app-BvKMgCPM.js";import{_ as Q}from"./AppLayout-CPl3rLGK.js";import{C as A}from"./auto-C0VlNTRY.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"flex justify-between items-center"},tt={class:"font-semibold text-xl text-gray-800 leading-tight"},et=["disabled"],st={key:0},ot={key:1},at={class:"py-12"},it={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},nt={class:"mb-5"},rt={key:0,class:"flex justify-center items-center py-20"},lt={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},dt={key:2},ct={class:"mb-4 text-right text-sm text-gray-500"},ut={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg mb-6"},ht={class:"p-6 bg-white"},gt={class:"flex items-center"},mt={class:"h-16 w-16 bg-indigo-100 rounded-lg flex items-center justify-center text-3xl text-indigo-600 font-bold"},pt={class:"ml-6"},_t={class:"text-xl font-semibold text-gray-900"},vt={class:"mt-1 flex items-center space-x-4"},xt={class:"text-sm text-gray-500"},ft={class:"text-sm text-gray-500"},yt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"},bt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},wt={class:"p-6 bg-white"},kt={class:"flex items-center"},Ct={class:"ml-4"},Dt={class:"mt-1 text-3xl font-semibold text-gray-900"},jt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Mt={class:"p-6 bg-white"},At={class:"flex items-center"},Tt={class:"ml-4"},Bt={class:"mt-1 text-3xl font-semibold text-gray-900"},$t={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},It={class:"p-6 bg-white"},Vt={class:"flex items-center"},zt={class:"ml-4"},St={class:"mt-1 text-3xl font-semibold text-gray-900"},Ht={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Lt={class:"p-6 bg-white"},Ft={class:"flex items-center"},Nt={class:"ml-4"},Rt={class:"mt-1 text-3xl font-semibold text-gray-900"},Ut={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},Ot={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Wt={class:"p-6 bg-white"},Zt={style:{height:"300px","max-height":"300px"}},qt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Et={class:"p-6 bg-white"},Gt={style:{height:"300px","max-height":"300px"}},Jt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg mb-6"},Kt={class:"p-6 bg-white"},Pt={style:{height:"200px","max-height":"200px"}},Qt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Xt={class:"p-6 bg-white"},Yt={key:0,class:"text-center py-8 text-gray-500"},te={key:1,class:"overflow-x-auto"},ee={class:"min-w-full divide-y divide-gray-200"},se={class:"bg-white divide-y divide-gray-200"},oe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ae={class:"px-6 py-4 whitespace-nowrap"},ie={class:"px-6 py-4 text-sm text-gray-500"},ne={class:"max-w-xs truncate"},re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},le={key:0,class:"flex items-center text-green-600"},de={key:1},ce={__name:"ChannelDetail",props:{channel_id:{type:Number,required:!0}},setup(V){const b=V,u=c(!1),_=c(null),w=c(null),h=c({id:null,name:"",telegram_id:"",username:""}),n=c({total_posts:0,sent_posts:0,scheduled_posts:0,failed_posts:0,subscribers:0,hourly_distribution:{},content_type_distribution:{},activity_data:{},recent_posts:[]}),v=c(null),x=c(null),f=c(null);let g=null,m=null,p=null;W(async()=>{B(!1)}),Z(()=>{T()});const T=()=>{g&&(g.destroy(),g=null),m&&(m.destroy(),m=null),p&&(p.destroy(),p=null)},z=()=>{T(),B(!0)},B=async(a=!1)=>{u.value=!0,_.value=null;try{const e=a?route("statistics.channel.detail",{channel:b.channel_id,refresh:!0}):route("statistics.channel.detail",{channel:b.channel_id}),s=await q.get(e);w.value=s.data.last_updated_at||new Date().toISOString(),s.data&&(h.value=s.data.channel||{id:b.channel_id,name:"Неизвестный канал",telegram_id:"N/A"},n.value={total_posts:s.data.total_posts||0,sent_posts:s.data.sent_posts||0,scheduled_posts:s.data.scheduled_posts||0,failed_posts:s.data.failed_posts||0,subscribers:s.data.subscribers||0,hourly_distribution:s.data.hourly_distribution||{},content_type_distribution:s.data.content_type_distribution||{text_only:70,with_image:20,with_video:5,with_file:5},activity_data:s.data.activity_data||{},recent_posts:s.data.recent_posts||[]}),u.value=!1,E(()=>{v.value&&N(),x.value&&R(),f.value&&U()})}catch(e){console.error("Failed to load channel statistics:",e),_.value="Не удалось загрузить статистику канала. Пожалуйста, попробуйте позже.",u.value=!1}},S=a=>{if(!a)return"Нет данных";const e=new Date(a);return new Intl.DateTimeFormat("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)},H=a=>{if(!a)return"Неизвестно";const e=new Date(a);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)},L=a=>{switch(a){case"sent":return"Отправлен";case"scheduled":return"Запланирован";case"failed":return"Ошибка";case"draft":return"Черновик";case"pending":return"В ожидании";default:return"Неизвестно"}},F=a=>{switch(a){case"sent":return"bg-green-100 text-green-800";case"scheduled":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"draft":return"bg-gray-100 text-gray-800";case"pending":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},N=()=>{if(!v.value)return;const a=v.value.getContext("2d");g&&g.destroy();const e=Array.from({length:24},(o,y)=>y),s=e.map(o=>n.value.hourly_distribution[o]||0),d=e.map(o=>`${o}:00`);g=new A(a,{type:"bar",data:{labels:d,datasets:[{label:"Количество постов",data:s,backgroundColor:"rgba(79, 70, 229, 0.5)",borderColor:"rgba(79, 70, 229, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})},R=()=>{if(!x.value)return;const a=x.value.getContext("2d"),e=n.value.content_type_distribution;m&&m.destroy(),m=new A(a,{type:"pie",data:{labels:Object.keys(e).map(s=>{switch(s){case"text_only":return"Только текст";case"with_image":return"С изображениями";case"with_video":return"С видео";case"with_file":return"С файлами";default:return s}}),datasets:[{data:Object.values(e),backgroundColor:["rgba(54, 162, 235, 0.7)","rgba(255, 99, 132, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:s=>{const d=s.label||"",o=s.raw,y=s.dataset.data.reduce((C,O)=>C+O,0),k=Math.round(o/y*100);return`${d}: ${o} (${k}%)`}}}}}})},U=()=>{if(!f.value)return;const a=f.value.getContext("2d");p&&p.destroy();const e=n.value.activity_data,s=Object.keys(e).sort(),d=s.map(o=>e[o]||0);p=new A(a,{type:"line",data:{labels:s.map(o=>{const[y,k,C]=o.split("-");return`${C}.${k}`}),datasets:[{label:"Количество постов",data:d,backgroundColor:"rgba(79, 70, 229, 0.1)",borderColor:"rgba(79, 70, 229, 1)",borderWidth:2,tension:.1,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}}})};return(a,e)=>{var s,d;return l(),r(I,null,[D($(G),{title:`Статистика канала ${((s=h.value)==null?void 0:s.name)||""}`},null,8,["title"]),D(Q,{title:`Статистика канала ${((d=h.value)==null?void 0:d.name)||""}`},{header:j(()=>{var o;return[t("div",Y,[t("h2",tt," Статистика канала "+i(((o=h.value)==null?void 0:o.name)||""),1),t("button",{onClick:z,class:"px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 flex items-center",disabled:u.value},[u.value?(l(),r("span",st,e[0]||(e[0]=[t("svg",{class:"animate-spin h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(l(),r("span",ot,e[1]||(e[1]=[t("svg",{class:"h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))),M(" "+i(u.value?"Обновление...":"Обновить данные"),1)],8,et)])]}),default:j(()=>[t("div",at,[t("div",it,[t("div",nt,[D($(J),{href:a.route("statistics"),class:"flex items-center text-indigo-600 hover:text-indigo-900"},{default:j(()=>e[2]||(e[2]=[t("svg",{class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),M(" Назад к общей статистике ")])),_:1},8,["href"])]),u.value?(l(),r("div",rt,e[3]||(e[3]=[t("div",{class:"loader"},null,-1),t("p",{class:"ml-4 text-gray-600"},"Загрузка статистики канала...",-1)]))):_.value?(l(),r("div",lt,[t("p",null,i(_.value),1)])):(l(),r("div",dt,[t("div",ct," Последнее обновление: "+i(w.value?H(w.value):"Неизвестно"),1),t("div",ut,[t("div",ht,[t("div",gt,[t("div",mt,i(h.value.name.charAt(0).toUpperCase()),1),t("div",pt,[t("h3",_t,i(h.value.name),1),t("div",vt,[t("div",xt," Telegram ID: "+i(h.value.telegram_id),1),t("div",ft," Участников: "+i(n.value.subscribers||"Н/Д"),1)])])])])]),t("div",yt,[t("div",bt,[t("div",wt,[t("div",kt,[e[5]||(e[5]=t("div",{class:"p-3 rounded-full bg-indigo-100 text-indigo-500"},[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t("div",Ct,[e[4]||(e[4]=t("p",{class:"text-sm font-medium text-gray-500 truncate"},"Всего постов",-1)),t("p",Dt,i(n.value.total_posts),1)])])])]),t("div",jt,[t("div",Mt,[t("div",At,[e[7]||(e[7]=t("div",{class:"p-3 rounded-full bg-green-100 text-green-500"},[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),t("div",Tt,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-gray-500 truncate"},"Отправлено",-1)),t("p",Bt,i(n.value.sent_posts),1)])])])]),t("div",$t,[t("div",It,[t("div",Vt,[e[9]||(e[9]=t("div",{class:"p-3 rounded-full bg-yellow-100 text-yellow-500"},[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",zt,[e[8]||(e[8]=t("p",{class:"text-sm font-medium text-gray-500 truncate"},"Запланировано",-1)),t("p",St,i(n.value.scheduled_posts),1)])])])]),t("div",Ht,[t("div",Lt,[t("div",Ft,[e[11]||(e[11]=t("div",{class:"p-3 rounded-full bg-red-100 text-red-500"},[t("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",Nt,[e[10]||(e[10]=t("p",{class:"text-sm font-medium text-gray-500 truncate"},"Ошибки",-1)),t("p",Rt,i(n.value.failed_posts),1)])])])])]),t("div",Ut,[t("div",Ot,[t("div",Wt,[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Распределение постов по часам",-1)),t("div",Zt,[t("canvas",{ref_key:"hourlyChart",ref:v},null,512)])])]),t("div",qt,[t("div",Et,[e[13]||(e[13]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Типы контента",-1)),t("div",Gt,[t("canvas",{ref_key:"contentTypeChart",ref:x},null,512)])])])]),t("div",Jt,[t("div",Kt,[e[14]||(e[14]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Активность по дням",-1)),t("div",Pt,[t("canvas",{ref_key:"activityChart",ref:f},null,512)])])]),t("div",Qt,[t("div",Xt,[e[17]||(e[17]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Последние посты",-1)),n.value.recent_posts&&n.value.recent_posts.length===0?(l(),r("div",Yt," Нет постов для отображения ")):(l(),r("div",te,[t("table",ee,[e[16]||(e[16]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Дата"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Статус"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Содержимое"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Медиа")])],-1)),t("tbody",se,[(l(!0),r(I,null,K(n.value.recent_posts,o=>(l(),r("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",oe,i(S(o.created_at)),1),t("td",ae,[t("span",{class:P(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",F(o.status)])},i(L(o.status)),3)]),t("td",ie,[t("div",ne,i(o.content),1)]),t("td",re,[o.has_media?(l(),r("div",le,e[15]||(e[15]=[t("svg",{class:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),M(" Да ")]))):(l(),r("div",de,"Нет"))])]))),128))])])]))])])]))])])]),_:1},8,["title"])],64)}}},pe=X(ce,[["__scopeId","data-v-f265a0bd"]]);export{pe as default};
