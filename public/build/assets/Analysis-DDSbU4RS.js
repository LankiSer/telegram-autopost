import{r as n,o as z,A as B,c as d,a as i,b as y,u as A,g as j,w as m,d as t,t as r,F as f,e as H,B as S,j as k}from"./app-BvKMgCPM.js";import{_ as T}from"./AppLayout-CPl3rLGK.js";import{C as h}from"./auto-C0VlNTRY.js";const F={class:"flex justify-between items-center"},R={class:"flex items-center space-x-4"},N={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},P=["disabled"],$={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white dark:text-gray-800",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},E={class:"py-6"},G={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},I={key:0,class:"flex justify-center my-8"},L={key:1,class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert"},O={key:2},U={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg mb-6"},W={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},Z={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},q={class:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4"},J={class:"flex items-center"},K={class:"text-2xl font-bold text-blue-800 dark:text-blue-300"},Q={class:"bg-green-50 dark:bg-green-900/30 rounded-lg p-4"},X={class:"flex items-center"},Y={class:"text-2xl font-bold text-green-800 dark:text-green-300"},tt={class:"bg-purple-50 dark:bg-purple-900/30 rounded-lg p-4"},et={class:"flex items-center"},st={class:"text-2xl font-bold text-purple-800 dark:text-purple-300"},at={class:"h-64"},rt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ot={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},lt={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},dt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},it={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},nt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},ct={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},ut={class:"overflow-x-auto"},gt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},bt={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},pt={class:"px-6 py-4 whitespace-nowrap"},xt={class:"flex items-center"},ht={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},vt={class:"px-6 py-4 whitespace-nowrap"},yt={class:"text-sm text-gray-500 dark:text-gray-400"},mt={class:"px-6 py-4 whitespace-nowrap"},ft={class:"text-sm text-gray-500 dark:text-gray-400"},kt={class:"px-6 py-4 whitespace-nowrap"},wt={class:"text-sm text-gray-500 dark:text-gray-400"},_t={class:"px-6 py-4 whitespace-nowrap"},Ct={class:"flex items-center"},Dt={class:"w-16 bg-gray-200 dark:bg-gray-700 rounded-full h-2.5"},Mt={class:"ml-2 text-sm text-gray-500 dark:text-gray-400"},jt={__name:"Analysis",setup(Vt){const c=n(!0),u=n(null),a=n({totalSubscribers:0,totalPosts:0,activeChannels:0,groups:[],subscribersData:{labels:[],data:[]},postsData:{labels:[],data:[]},groupsData:{labels:[],data:[]}}),g=n(null),b=n(null),p=n(null);let s={};const x=n(null);z(()=>{v()});const v=async(o=!1)=>{c.value=!0,u.value=null;try{const e=o?route("features.analysis",{refresh:!0}):route("features.analysis"),l=await B.get(e);Object.assign(a.value,l.data),x.value=l.data.last_updated_at,setTimeout(()=>{g.value&&w(),b.value&&_(),p.value&&C()},100)}catch(e){console.error("Failed to fetch statistics:",e),u.value="Не удалось загрузить статистику. Пожалуйста, попробуйте позже.",c.value=!1}},w=()=>{s.groupsChart&&s.groupsChart.destroy();const o=g.value.getContext("2d");s.groupsChart=new h(o,{type:"bar",data:{labels:a.value.groupsData.labels,datasets:[{label:"Количество постов",data:a.value.groupsData.data,backgroundColor:"rgba(99, 102, 241, 0.6)",borderColor:"rgba(99, 102, 241, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})},_=()=>{s.subscribersChart&&s.subscribersChart.destroy();const o=b.value.getContext("2d");s.subscribersChart=new h(o,{type:"line",data:{labels:a.value.subscribersData.labels,datasets:[{label:"Подписчики",data:a.value.subscribersData.data,fill:!0,backgroundColor:"rgba(16, 185, 129, 0.1)",borderColor:"rgba(16, 185, 129, 1)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1}})},C=()=>{s.postsChart&&s.postsChart.destroy();const o=p.value.getContext("2d");s.postsChart=new h(o,{type:"line",data:{labels:a.value.postsData.labels,datasets:[{label:"Посты",data:a.value.postsData.data,fill:!0,backgroundColor:"rgba(244, 114, 182, 0.1)",borderColor:"rgba(244, 114, 182, 1)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1}})};function D(){V(),v(!0)}function M(o){const e=new Date(o);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}function V(){s.groupsChart&&(s.groupsChart.destroy(),s.groupsChart=null),s.subscribersChart&&(s.subscribersChart.destroy(),s.subscribersChart=null),s.postsChart&&(s.postsChart.destroy(),s.postsChart=null)}return(o,e)=>(i(),d(f,null,[y(A(j),{title:"Анализ Telegram-сервисов"}),y(T,null,{header:m(()=>[t("div",F,[e[1]||(e[1]=t("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-200 leading-tight"}," Анализ Telegram-сервисов ",-1)),t("div",R,[x.value?(i(),d("div",N," Последнее обновление: "+r(M(x.value)),1)):k("",!0),t("button",{onClick:D,class:"inline-flex items-center px-4 py-2 bg-gray-800 dark:bg-gray-200 border border-transparent rounded-md font-semibold text-xs text-white dark:text-gray-800 uppercase tracking-widest hover:bg-gray-700 dark:hover:bg-white focus:bg-gray-700 dark:focus:bg-white active:bg-gray-900 dark:active:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition ease-in-out duration-150",disabled:c.value},[c.value?(i(),d("svg",$,e[0]||(e[0]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):k("",!0),t("span",null,r(c.value?"Обновление...":"Обновить данные"),1)],8,P)])])]),default:m(()=>[t("div",E,[t("div",G,[c.value?(i(),d("div",I,e[2]||(e[2]=[t("svg",{class:"animate-spin h-8 w-8 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):u.value?(i(),d("div",L,[t("p",null,r(u.value),1)])):(i(),d("div",O,[t("div",U,[t("div",W,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Общий обзор групп",-1)),t("div",Z,[t("div",q,[t("div",J,[e[4]||(e[4]=t("div",{class:"bg-blue-100 dark:bg-blue-800 rounded-full p-2 mr-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-blue-600 dark:text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),t("div",null,[e[3]||(e[3]=t("div",{class:"text-sm text-blue-600 dark:text-blue-400"},"Всего подписчиков",-1)),t("div",K,r(a.value.totalSubscribers),1)])])]),t("div",Q,[t("div",X,[e[6]||(e[6]=t("div",{class:"bg-green-100 dark:bg-green-800 rounded-full p-2 mr-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-green-600 dark:text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})])],-1)),t("div",null,[e[5]||(e[5]=t("div",{class:"text-sm text-green-600 dark:text-green-400"},"Всего постов",-1)),t("div",Y,r(a.value.totalPosts),1)])])]),t("div",tt,[t("div",et,[e[8]||(e[8]=t("div",{class:"bg-purple-100 dark:bg-purple-800 rounded-full p-2 mr-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-purple-600 dark:text-purple-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t("div",null,[e[7]||(e[7]=t("div",{class:"text-sm text-purple-600 dark:text-purple-400"},"Активных каналов за 30 дней",-1)),t("div",st,r(a.value.activeChannels),1)])])])]),e[10]||(e[10]=t("h4",{class:"font-medium text-gray-700 dark:text-gray-300 mb-3"},"Распределение постов по группам",-1)),t("div",at,[t("canvas",{ref_key:"groupsChart",ref:g},null,512)])])]),t("div",rt,[t("div",ot,[t("div",lt,[e[11]||(e[11]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Рост подписчиков",-1)),t("canvas",{ref_key:"subscribersChart",ref:b,height:"200"},null,512)])]),t("div",dt,[t("div",it,[e[12]||(e[12]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Активность публикаций",-1)),t("canvas",{ref_key:"postsChart",ref:p,height:"200"},null,512)])])]),t("div",nt,[t("div",ct,[e[14]||(e[14]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Группы каналов",-1)),t("div",ut,[t("table",gt,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Название группы "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Каналов "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Подписчиков "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Постов "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Активность ")])],-1)),t("tbody",bt,[(i(!0),d(f,null,H(a.value.groups,l=>(i(),d("tr",{key:l.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[t("td",pt,[t("div",xt,[t("div",ht,r(l.name),1)])]),t("td",vt,[t("div",yt,r(l.channels_count),1)]),t("td",mt,[t("div",ft,r(l.subscribers_count),1)]),t("td",kt,[t("div",wt,r(l.posts_count),1)]),t("td",_t,[t("div",Ct,[t("div",Dt,[t("div",{class:"bg-blue-600 h-2.5 rounded-full",style:S(`width: ${l.activity_rate}%`)},null,4)]),t("span",Mt,r(l.activity_rate)+"%",1)])])]))),128))])])])])])]))])])]),_:1})],64))}};export{jt as default};
