import{r as l,o as F,G as N,A as S,L as Z,c as d,a as i,b as k,u as V,g as E,w,d as t,t as n,j as U,F as T,e as I,i as O,S as $}from"./app-OAsktpdo.js";import{_ as G}from"./AppLayout-CrSf5v8z.js";import{C as c}from"./auto-C0VlNTRY.js";const q={class:"flex justify-between items-center"},J={class:"flex space-x-2"},K=["disabled"],Q={key:0},X={key:1},Y={class:"py-6"},tt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},et={key:0,class:"flex justify-center my-8"},at={key:1,class:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert"},st={key:2},rt={class:"mb-4 text-right text-sm text-gray-500 dark:text-gray-400"},ot={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg mb-6"},lt={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},dt={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},it={class:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4"},nt={class:"text-2xl font-bold text-blue-800 dark:text-blue-300"},gt={class:"bg-green-50 dark:bg-green-900/30 rounded-lg p-4"},bt={class:"text-2xl font-bold text-green-800 dark:text-green-300"},ct={class:"bg-purple-50 dark:bg-purple-900/30 rounded-lg p-4"},ut={class:"text-2xl font-bold text-purple-800 dark:text-purple-300"},ht={class:"bg-amber-50 dark:bg-amber-900/30 rounded-lg p-4"},vt={class:"text-2xl font-bold text-amber-800 dark:text-amber-300"},mt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},yt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},xt={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},pt={style:{height:"300px","max-height":"300px",position:"relative"}},_t={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},ft={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},kt={style:{height:"300px","max-height":"300px",position:"relative"}},wt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},Ct={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},At={style:{height:"300px","max-height":"300px",position:"relative"}},Pt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},Vt={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},Tt={style:{height:"300px","max-height":"300px",position:"relative"}},Ot={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg mb-6"},Wt={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},Dt={style:{height:"300px","max-height":"300px",position:"relative"}},jt={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},zt={class:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},Bt={class:"space-y-4"},Lt={class:"flex"},Mt={class:"ml-3"},Rt={class:"text-sm font-medium text-blue-800 dark:text-blue-200"},Ht={class:"mt-1 text-sm text-blue-700 dark:text-blue-300"},Ft={key:0,class:"text-center py-4 text-gray-500 dark:text-gray-400"},It={__name:"PostAnalytics",setup(Nt){const g=l(!1),u=l(null),v=l(null),r=l({totalPosts:0,avgPostsPerDay:0,avgCharCount:0,mediaPostsPercent:0,dayOfWeek:{labels:[],data:[]},postLength:{labels:[],data:[]},mediaVsText:{labels:[],data:[]},hourlyActivity:{labels:[],data:[]},timeline:{labels:[],data:[]},recommendations:[]}),m=l(null),y=l(null),x=l(null),p=l(null),_=l(null);let o={};F(()=>{A(!1)}),N(()=>{C()});const C=()=>{Object.values(o).forEach(a=>{a&&a.destroy()}),o={}},W=()=>{C(),A(!0)},A=async(a=!1)=>{var e,b,h,P;g.value=!0,u.value=null;try{const f=a?route("statistics.posts",{refresh:!0}):route("statistics.posts"),s=await S.get(f);console.log("Raw post analytics data:",s.data),v.value=s.data.last_updated_at||new Date().toISOString(),r.value={totalPosts:s.data.total_posts||0,avgPostsPerDay:s.data.avg_posts_per_day||0,avgCharCount:s.data.avg_char_count||0,mediaPostsPercent:s.data.media_posts_percent||0,dayOfWeek:{labels:Object.keys(s.data.weekday_stats||{}),data:Object.values(s.data.weekday_stats||{})},postLength:{labels:["Короткие","Средние","Длинные"],data:s.data.length_distribution?[s.data.length_distribution.short||0,s.data.length_distribution.medium||0,s.data.length_distribution.long||0]:[0,0,0]},mediaVsText:{labels:["С медиа","Только текст"],data:s.data.media_vs_text?[s.data.media_vs_text.with_media||0,s.data.media_vs_text.text_only||0]:[0,0]},hourlyActivity:{labels:((e=s.data.hourly_activity)==null?void 0:e.labels)||Array.from({length:24},(St,H)=>`${H}:00`),data:((b=s.data.hourly_activity)==null?void 0:b.data)||Array(24).fill(0)},timeline:{labels:((h=s.data.timeline)==null?void 0:h.labels)||[],data:((P=s.data.timeline)==null?void 0:P.data)||[]},recommendations:s.data.recommendations||[]},g.value=!1,Z(()=>{D()})}catch(f){console.error("Failed to fetch analytics:",f),u.value="Не удалось загрузить аналитику. Пожалуйста, попробуйте позже.",g.value=!1}},D=()=>{Object.values(o).forEach(a=>{a&&a.destroy()}),o={},m.value&&j(),y.value&&z(),x.value&&B(),p.value&&L(),_.value&&M()},j=()=>{const a=m.value.getContext("2d");o.dayOfWeek=new c(a,{type:"bar",data:{labels:r.value.dayOfWeek.labels,datasets:[{label:"Количество постов",data:r.value.dayOfWeek.data,backgroundColor:"rgba(79, 70, 229, 0.6)",borderColor:"rgba(79, 70, 229, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})},z=()=>{const a=y.value.getContext("2d");o.length=new c(a,{type:"bar",data:{labels:r.value.postLength.labels,datasets:[{label:"Количество постов",data:r.value.postLength.data,backgroundColor:"rgba(16, 185, 129, 0.6)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})},B=()=>{const a=x.value.getContext("2d");o.mediaVsText=new c(a,{type:"pie",data:{labels:r.value.mediaVsText.labels,datasets:[{data:r.value.mediaVsText.data,backgroundColor:["rgba(248, 113, 113, 0.6)","rgba(96, 165, 250, 0.6)"],borderColor:["rgba(248, 113, 113, 1)","rgba(96, 165, 250, 1)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!0}})},L=()=>{const a=p.value.getContext("2d");o.hourly=new c(a,{type:"line",data:{labels:r.value.hourlyActivity.labels,datasets:[{label:"Количество постов",data:r.value.hourlyActivity.data,backgroundColor:"rgba(244, 114, 182, 0.2)",borderColor:"rgba(244, 114, 182, 1)",borderWidth:2,tension:.3,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})},M=()=>{const a=_.value.getContext("2d");o.timeline=new c(a,{type:"line",data:{labels:r.value.timeline.labels,datasets:[{label:"Количество постов",data:r.value.timeline.data,backgroundColor:"rgba(251, 191, 36, 0.2)",borderColor:"rgba(251, 191, 36, 1)",borderWidth:2,tension:.3,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{tooltip:{callbacks:{title:function(e){return e[0].label}}}},scales:{y:{beginAtZero:!0}}}})},R=a=>{if(!a)return"";const e=new Date(a);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)};return(a,e)=>(i(),d(T,null,[k(V(E),{title:"Аналитика постов"}),k(G,null,{header:w(()=>[t("div",q,[e[3]||(e[3]=t("h2",{class:"text-xl font-semibold text-gray-800 dark:text-gray-200 leading-tight"}," Аналитика постов ",-1)),t("div",J,[t("button",{onClick:W,class:"px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 flex items-center",disabled:g.value},[g.value?(i(),d("span",Q,e[0]||(e[0]=[t("svg",{class:"animate-spin h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):(i(),d("span",X,e[1]||(e[1]=[t("svg",{class:"h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)]))),O(" "+n(g.value?"Обновление...":"Обновить данные"),1)],8,K),k(V($),{href:a.route("statistics"),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300"},{default:w(()=>e[2]||(e[2]=[O(" Назад к общей статистике ")])),_:1},8,["href"])])])]),default:w(()=>[t("div",Y,[t("div",tt,[g.value?(i(),d("div",et,e[4]||(e[4]=[t("svg",{class:"animate-spin h-8 w-8 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):u.value?(i(),d("div",at,[t("p",null,n(u.value),1)])):(i(),d("div",st,[t("div",rt," Последнее обновление: "+n(v.value?R(v.value):"Неизвестно"),1),t("div",ot,[t("div",lt,[e[9]||(e[9]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Общие показатели",-1)),t("div",dt,[t("div",it,[e[5]||(e[5]=t("div",{class:"text-sm text-blue-600 dark:text-blue-400"},"Всего постов",-1)),t("div",nt,n(r.value.totalPosts),1)]),t("div",gt,[e[6]||(e[6]=t("div",{class:"text-sm text-green-600 dark:text-green-400"},"Постов в среднем в день",-1)),t("div",bt,n(r.value.avgPostsPerDay),1)]),t("div",ct,[e[7]||(e[7]=t("div",{class:"text-sm text-purple-600 dark:text-purple-400"},"Среднее кол-во знаков",-1)),t("div",ut,n(r.value.avgCharCount),1)]),t("div",ht,[e[8]||(e[8]=t("div",{class:"text-sm text-amber-600 dark:text-amber-400"},"Посты с медиа",-1)),t("div",vt,n(r.value.mediaPostsPercent)+"%",1)])])])]),t("div",mt,[t("div",yt,[t("div",xt,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Распределение по дням недели",-1)),t("div",pt,[t("canvas",{ref_key:"dayOfWeekChart",ref:m},null,512)])])]),t("div",_t,[t("div",ft,[e[11]||(e[11]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Распределение по длине",-1)),t("div",kt,[t("canvas",{ref_key:"lengthChart",ref:y},null,512)])])]),t("div",wt,[t("div",Ct,[e[12]||(e[12]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Медиа vs текстовые посты",-1)),t("div",At,[t("canvas",{ref_key:"mediaVsTextChart",ref:x},null,512)])])]),t("div",Pt,[t("div",Vt,[e[13]||(e[13]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Активность по часам",-1)),t("div",Tt,[t("canvas",{ref_key:"hourlyChart",ref:p},null,512)])])])]),t("div",Ot,[t("div",Wt,[e[14]||(e[14]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Динамика постов",-1)),t("div",Dt,[t("canvas",{ref_key:"timelineChart",ref:_},null,512)])])]),t("div",jt,[t("div",zt,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold mb-4 dark:text-gray-200"},"Рекомендации по улучшению",-1)),t("div",Bt,[(i(!0),d(T,null,I(r.value.recommendations,(b,h)=>(i(),d("div",{key:h,class:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4"},[t("div",Lt,[e[15]||(e[15]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-blue-600 dark:text-blue-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z","clip-rule":"evenodd"})])],-1)),t("div",Mt,[t("h4",Rt,n(b.title),1),t("div",Ht,[t("p",null,n(b.description),1)])])])]))),128)),r.value.recommendations.length===0?(i(),d("div",Ft," Недостаточно данных для формирования рекомендаций ")):U("",!0)])])])]))])])]),_:1})],64))}};export{It as default};
